// Full USDA Calcium Dataset - Imported from vanilla app
export const USDA_CALCIUM_DATA = [
  // High calcium foods (500+ mg)
  {
    name: "Collards, frozen, chopped, cooked, boiled, drained, without salt",
    calcium: 1770,
    measure: "10.0 oz package",
    isCustom: false,
  },
  {
    name: "Milk, dry, nonfat, regular, without added vitamin A and vitamin D",
    calcium: 1508,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Milk, buttermilk, dried",
    calcium: 1421,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Collards, frozen, chopped, cooked, boiled, drained, with salt",
    calcium: 1330,
    measure: "10.0 oz package",
    isCustom: false,
  },
  {
    name: "Sesame flour, low-fat",
    calcium: 1170,
    measure: "1.0 oz",
    isCustom: false,
  },
  {
    name: "Tahini, from sesame seeds",
    calcium: 1160,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Milk, dry, whole, with added vitamin D",
    calcium: 1155,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Seeds, sesame seeds, whole, roasted and toasted",
    calcium: 1404,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Cheese, parmesan, grated",
    calcium: 1376,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Cheese, romano",
    calcium: 1064,
    measure: "1.0 cups, diced",
    isCustom: false,
  },
  {
    name: "Sardines, canned in oil, drained solids with bone",
    calcium: 569,
    measure: "1.0 can (3.75 oz)",
    isCustom: false,
  },
  {
    name: "Cornmeal, yellow, self-rising, bolted, with wheat flour added, enriched",
    calcium: 508,
    measure: "1.0 cups",
    isCustom: false,
  },

  // Medium-high calcium foods (300-500 mg)
  {
    name: "Yogurt, plain, low fat",
    calcium: 415,
    measure: "1.0 cups (8 fl oz)",
    isCustom: false,
  },
  {
    name: "Milk, reduced fat, fluid, 2% milkfat, with added vitamin A and vitamin D",
    calcium: 293,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Milk, whole, 3.25% milkfat, with added vitamin A and vitamin D",
    calcium: 276,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Milk, lowfat, fluid, 1% milkfat, with added vitamin A and vitamin D",
    calcium: 305,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Tofu, firm, prepared with calcium sulfate",
    calcium: 253,
    measure: "0.5 cups (4 oz)",
    isCustom: false,
  },
  {
    name: "Salmon, sockeye, cooked, dry heat",
    calcium: 203,
    measure: "3.0 oz",
    isCustom: false,
  },
  {
    name: "Cheese, ricotta, part skim milk",
    calcium: 337,
    measure: "0.5 cups",
    isCustom: false,
  },
  {
    name: "Cheese, ricotta, whole milk",
    calcium: 255,
    measure: "0.5 cups",
    isCustom: false,
  },
  {
    name: "Spinach, cooked, boiled, drained, without salt",
    calcium: 245,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Turnip greens, cooked, boiled, drained, without salt",
    calcium: 197,
    measure: "1.0 cups, chopped",
    isCustom: false,
  },
  {
    name: "Kale, cooked, boiled, drained, without salt",
    calcium: 177,
    measure: "1.0 cups, chopped",
    isCustom: false,
  },

  // Medium calcium foods (100-300 mg)
  { name: "Cheese, cheddar", calcium: 204, measure: "1.0 oz", isCustom: false },
  { name: "Cheese, swiss", calcium: 224, measure: "1.0 oz", isCustom: false },
  {
    name: "Cheese, mozzarella, part skim milk",
    calcium: 183,
    measure: "1.0 oz",
    isCustom: false,
  },
  {
    name: "Almonds",
    calcium: 76,
    measure: "1.0 oz (23 whole kernels)",
    isCustom: false,
  },
  {
    name: "Broccoli, cooked, boiled, drained, without salt",
    calcium: 62,
    measure: "1.0 cups chopped",
    isCustom: false,
  },
  {
    name: "Figs, dried, uncooked",
    calcium: 162,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "White beans, mature seeds, cooked, boiled, without salt",
    calcium: 161,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Soybeans, green, cooked, boiled, drained, without salt",
    calcium: 175,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Orange juice, canned, unsweetened",
    calcium: 27,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Ice cream, vanilla",
    calcium: 128,
    measure: "0.5 cups",
    isCustom: false,
  },

  // Lower calcium foods (50-100 mg)
  {
    name: "Yogurt, vanilla, low fat",
    calcium: 100,
    measure: "4.0 oz",
    isCustom: false,
  },
  {
    name: "Cottage cheese, lowfat, 2% milkfat",
    calcium: 78,
    measure: "0.5 cups",
    isCustom: false,
  },
  {
    name: "Sour cream, reduced fat",
    calcium: 32,
    measure: "2.0 tbsp",
    isCustom: false,
  },
  {
    name: "Buttermilk, fluid, cultured, lowfat",
    calcium: 116,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Pudding, chocolate, ready-to-eat",
    calcium: 75,
    measure: "4.0 oz",
    isCustom: false,
  },
  {
    name: "Cereal, ready-to-eat, fortified",
    calcium: 100,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Bread, whole-wheat, commercially prepared",
    calcium: 30,
    measure: "1.0 slice",
    isCustom: false,
  },
  {
    name: "Bread, white, commercially prepared",
    calcium: 38,
    measure: "1.0 slice",
    isCustom: false,
  },
  {
    name: "Tortilla, flour, ready-to-bake or -fry",
    calcium: 37,
    measure: "1.0 tortilla (8 inch diameter)",
    isCustom: false,
  },

  // Vegetables and greens
  {
    name: "Bok choy, cooked, boiled, drained, without salt",
    calcium: 158,
    measure: "1.0 cups, shredded",
    isCustom: false,
  },
  {
    name: "Mustard greens, cooked, boiled, drained, without salt",
    calcium: 104,
    measure: "1.0 cups, chopped",
    isCustom: false,
  },
  {
    name: "Swiss chard, cooked, boiled, drained, without salt",
    calcium: 102,
    measure: "1.0 cups, chopped",
    isCustom: false,
  },
  {
    name: "Okra, cooked, boiled, drained, without salt",
    calcium: 82,
    measure: "1.0 cups, sliced",
    isCustom: false,
  },
  {
    name: "Brussels sprouts, cooked, boiled, drained, without salt",
    calcium: 56,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Green beans, cooked, boiled, drained, without salt",
    calcium: 55,
    measure: "1.0 cups",
    isCustom: false,
  },

  // Fish and seafood
  {
    name: "Salmon, pink, canned, drained solids with bone",
    calcium: 181,
    measure: "3.0 oz",
    isCustom: false,
  },
  {
    name: "Mackerel, Pacific and jack, mixed species, cooked, dry heat",
    calcium: 184,
    measure: "3.0 oz",
    isCustom: false,
  },
  {
    name: "Crab, blue, cooked, moist heat",
    calcium: 89,
    measure: "3.0 oz",
    isCustom: false,
  },
  {
    name: "Shrimp, mixed species, cooked, moist heat",
    calcium: 33,
    measure: "3.0 oz",
    isCustom: false,
  },

  // Fortified and alternative foods
  {
    name: "Soy milk, chocolate, with added calcium, vitamins A and D",
    calcium: 301,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Rice milk, unsweetened, with added calcium, vitamins A and D",
    calcium: 283,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Almond milk, sweetened, vanilla flavor",
    calcium: 451,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Orange juice, chilled, includes from concentrate, fortified with calcium",
    calcium: 349,
    measure: "1.0 cups",
    isCustom: false,
  },

  // Nuts and seeds
  {
    name: "Sesame seeds, whole, dried",
    calcium: 351,
    measure: "0.25 cups",
    isCustom: false,
  },
  {
    name: "Tahini, from roasted and toasted sesame seeds",
    calcium: 64,
    measure: "1.0 tbsp",
    isCustom: false,
  },
  {
    name: "Brazil nuts, dried, unblanched",
    calcium: 45,
    measure: "1.0 oz (6 nuts)",
    isCustom: false,
  },
  {
    name: "Hazelnuts, blanched",
    calcium: 32,
    measure: "1.0 oz",
    isCustom: false,
  },

  // Beans and legumes
  {
    name: "Navy beans, mature seeds, cooked, boiled, without salt",
    calcium: 127,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Chickpeas, mature seeds, cooked, boiled, without salt",
    calcium: 80,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Black-eyed peas, mature seeds, cooked, boiled, without salt",
    calcium: 41,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Lentils, mature seeds, cooked, boiled, without salt",
    calcium: 37,
    measure: "1.0 cups",
    isCustom: false,
  },

  // Grains and cereals
  { name: "Quinoa, cooked", calcium: 31, measure: "1.0 cups", isCustom: false },
  {
    name: "Oatmeal, cooked with water, without salt",
    calcium: 21,
    measure: "1.0 cups",
    isCustom: false,
  },
  {
    name: "Brown rice, cooked",
    calcium: 20,
    measure: "1.0 cups",
    isCustom: false,
  },

  // Additional common foods
  {
    name: "Egg, whole, cooked, hard-boiled",
    calcium: 25,
    measure: "1.0 large",
    isCustom: false,
  },
  {
    name: "Chicken breast, meat only, cooked, roasted",
    calcium: 13,
    measure: "3.0 oz",
    isCustom: false,
  },
  {
    name: "Ground beef, 85% lean meat / 15% fat, cooked, crumbles",
    calcium: 18,
    measure: "3.0 oz",
    isCustom: false,
  },
];

// Search stopwords to ignore
const SEARCH_STOPWORDS = [
  "with",
  "without",
  "and",
  "or",
  "the",
  "of",
  "in",
  "on",
  "at",
  "to",
  "for",
  "from",
  "by",
  "added",
  "prepared",
  "cooked",
  "raw",
  "fresh",
  "frozen",
  "canned",
  "dried",
  "chopped",
  "sliced",
  "diced",
  "whole",
  "ground",
  "boiled",
  "baked",
  "fried",
  "roasted",
  "steamed",
];

// Helper function to search foods
export function searchFoods(query, customFoods = []) {
  if (!query || query.length < 2) return [];

  const keywords = query
    .toLowerCase()
    .split(/[,\s]+/)
    .filter((word) => word.length > 1)
    .filter((word) => !SEARCH_STOPWORDS.includes(word));

  if (keywords.length === 0) return [];

  // Combine USDA and custom foods
  const allFoods = [...USDA_CALCIUM_DATA, ...customFoods];

  const results = allFoods
    .map((food) => {
      const searchText = food.name.toLowerCase();
      let score = 0;
      let hasMatch = false;

      keywords.forEach((keyword) => {
        if (searchText.includes(keyword)) {
          hasMatch = true;
          // Exact word match gets higher score
          if (searchText.split(/\s+/).includes(keyword)) {
            score += 10;
          } else {
            score += 5;
          }

          // Boost score if keyword appears at start
          if (searchText.startsWith(keyword)) {
            score += 15;
          }
        }
      });

      // Must match at least one keyword
      if (!hasMatch) return null;

      // Boost score for foods with higher calcium content
      score += Math.log(food.calcium + 1) * 0.5;

      return { ...food, searchScore: score };
    })
    .filter(Boolean)
    .sort((a, b) => b.searchScore - a.searchScore)
    .slice(0, 15); // Limit results

  return results;
}

// Helper function to parse serving sizes
export function parseServingSize(measure) {
  if (!measure) return { quantity: 1, unit: "serving" };

  // Extract number from beginning of measure string
  const match = measure.match(/^([0-9]*\.?[0-9]+)/);
  const quantity = match ? parseFloat(match[1]) : 1;

  // Extract unit (everything after the number)
  const unit = measure.replace(/^[0-9]*\.?[0-9]+\s*/, "").trim() || "serving";

  return { quantity, unit };
}

// Helper function to standardize units
export function standardizeUnit(unit) {
  const unitMap = {
    cups: "cup",
    cup: "cup",
    tbsp: "tablespoon",
    tablespoons: "tablespoon",
    tsp: "teaspoon",
    teaspoons: "teaspoon",
    oz: "ounce",
    ounces: "ounce",
    lb: "pound",
    pounds: "pound",
    g: "gram",
    grams: "gram",
    mg: "milligram",
    milligrams: "milligram",
    ml: "milliliter",
    milliliters: "milliliter",
    l: "liter",
    liters: "liter",
    "fl oz": "fluid ounce",
    "fluid ounces": "fluid ounce",
    piece: "piece",
    pieces: "piece",
    slice: "slice",
    slices: "slice",
    serving: "serving",
    servings: "serving",
  };

  return unitMap[unit.toLowerCase()] || unit;
}
